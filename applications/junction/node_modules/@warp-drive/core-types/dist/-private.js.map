{"version":3,"file":"-private.js","sources":["../src/-private.ts"],"sourcesContent":["// in testing mode, we utilize globals to ensure only one copy exists of\n// these maps, due to bugs in ember-auto-import\nimport { DEBUG, TESTING } from '@warp-drive/build-config/env';\n\nimport { name, version } from '../package.json';\n\ntype UniversalTransientKey =\n  // @ember-data/request\n  'REQ_ID';\n\ntype UniversalKey =\n  | `(transient) ${UniversalTransientKey}`\n  // @ember-data/request\n  | 'RequestMap'\n  | 'PromiseCache'\n  | 'RequestCache'\n  // @warp-drive/core-types/request\n  | 'SkipCache'\n  | 'EnableHydration';\n\ntype TransientKey =\n  // @ember-data/tracking\n  | 'TRANSACTION'\n  // @ember-data/graph\n  | 'transactionRef'\n  // @ember-data/store\n  | 'configuredGenerationMethod'\n  | 'configuredUpdateMethod'\n  | 'configuredForgetMethod'\n  | 'configuredResetMethod'\n  | 'configuredKeyInfoMethod';\n\ntype GlobalKey =\n  | `(transient) ${TransientKey}`\n  // @ember-data/adapter\n  | 'AdapterError'\n  | 'InvalidError'\n  | 'TimeoutError'\n  | 'AbortError'\n  | 'UnauthorizedError'\n  | 'ForbiddenError'\n  | 'NotFoundError'\n  | 'ConflictError'\n  | 'ServerError'\n  // @ember-data/tracking\n  | 'Signals'\n  // @ember-data/store LegacySupport\n  | 'AvailableShims'\n  // @ember-data/store RecordArrayManager\n  | 'FAKE_ARR'\n  // @ember-data/store IdentifierArray\n  | '#signal'\n  | '#source'\n  | '#update'\n  | '#notify'\n  | 'IS_COLLECTION'\n  // @ember-data/store RequestCache\n  | 'Touching'\n  | 'RequestPromise'\n  // @ember-data/legacy-compat FetchManager\n  | 'SaveOp'\n  // @ember-data/model\n  | 'LEGACY_SUPPORT'\n  | 'LegacySupport'\n  // @ember-data/graph\n  | 'Graphs'\n  // @ember-data/request\n  | 'IS_FROZEN'\n  | 'IS_CACHE_HANDLER'\n  // @ember-data/store IdentityCache\n  | 'DEBUG_MAP'\n  | 'IDENTIFIERS'\n  | 'DOCUMENTS'\n  // @ember-data/store InstanceCache\n  | 'CacheForIdentifierCache'\n  | 'RecordCache'\n  | 'StoreMap'\n  // @warp-drive/core-types/symbols\n  | 'Store'\n  | '$type'\n  | 'TransformName'\n  | 'RequestSignature'\n  // @warp-drive/core-types/request\n  | 'IS_FUTURE'\n  | 'DOC'\n  // @warp-drive/schema-record\n  | 'ManagedArrayMap'\n  | 'ManagedObjectMap'\n  | 'Support'\n  | 'SOURCE'\n  | 'MUTATE'\n  | 'ARRAY_SIGNAL'\n  | 'OBJECT_SIGNAL'\n  | 'NOTIFY'\n  | 'Destroy'\n  | 'Identifier'\n  | 'Editable'\n  | 'EmbeddedPath'\n  | 'EmbeddedType'\n  | 'Parent'\n  | 'Checkout'\n  | 'Legacy';\n\ntype ModuleScopedCaches = Record<GlobalKey, unknown>;\n\nconst GlobalRef = globalThis as unknown as Record<\n  string,\n  {\n    __warpDrive_ModuleScopedCaches?: ModuleScopedCaches;\n    __warpDrive_hasOtherCopy?: boolean;\n    __version: string;\n  }\n> & {\n  __warpDrive_universalCache: Record<UniversalKey, unknown>;\n};\nconst UniversalCache = (GlobalRef.__warpDrive_universalCache =\n  GlobalRef.__warpDrive_universalCache ?? ({} as Record<UniversalKey, unknown>));\n\n// in order to support mirror packages, we ensure that each\n// unique package name has its own global cache\nGlobalRef[name] = GlobalRef[name] ?? { __version: version };\nconst GlobalSink = GlobalRef[name];\n\nif (DEBUG) {\n  if (GlobalSink.__version !== version) {\n    throw new Error('Multiple versions of WarpDrive detected, the application will malfunction.');\n  }\n}\n\nconst ModuleScopedCaches = GlobalSink.__warpDrive_ModuleScopedCaches ?? ({} as ModuleScopedCaches);\nif (TESTING) {\n  if (!GlobalSink.__warpDrive_ModuleScopedCaches) {\n    GlobalSink.__warpDrive_ModuleScopedCaches = ModuleScopedCaches;\n  } else {\n    // eslint-disable-next-line no-console\n    console.warn(`\nMultiple copies of EmberData have been detected. This may be due to a bug in ember-auto-import\n  in which test assets get their own copy of some v2-addons. This can cause the application to\n  malfunction as each copy will maintain its own separate state.`);\n  }\n} else {\n  if (GlobalSink.__warpDrive_hasOtherCopy) {\n    throw new Error('Multiple copies of EmberData detected, the application will malfunction.');\n  }\n  GlobalSink.__warpDrive_hasOtherCopy = true;\n}\n\ntype UniqueSymbol<T extends string> = `___(unique) Symbol(${T})`;\ntype UniqueSymbolOr<T, K extends string> = T extends symbol ? UniqueSymbol<K> : T;\n\nexport function getOrSetGlobal<T, K extends GlobalKey>(key: K, value: T): UniqueSymbolOr<T, K> {\n  if (TESTING) {\n    const existing = ModuleScopedCaches[key];\n    if (existing === undefined) {\n      return (ModuleScopedCaches[key] = value) as UniqueSymbolOr<T, K>;\n    } else {\n      return existing as UniqueSymbolOr<T, K>;\n    }\n  } else {\n    return value as UniqueSymbolOr<T, K>;\n  }\n}\n\nexport function peekTransient<T>(key: TransientKey): T | null {\n  const globalKey: `(transient) ${TransientKey}` = `(transient) ${key}`;\n  return (ModuleScopedCaches[globalKey] as T) ?? null;\n}\n\nexport function setTransient<T>(key: TransientKey, value: T): T {\n  const globalKey: `(transient) ${TransientKey}` = `(transient) ${key}`;\n  return (ModuleScopedCaches[globalKey] = value);\n}\n\nexport function getOrSetUniversal<T, K extends UniversalKey>(key: K, value: T): UniqueSymbolOr<T, K> {\n  if (TESTING) {\n    const existing = UniversalCache[key];\n    if (existing === undefined) {\n      return (UniversalCache[key] = value) as UniqueSymbolOr<T, K>;\n    } else {\n      return existing as UniqueSymbolOr<T, K>;\n    }\n  } else {\n    return value as UniqueSymbolOr<T, K>;\n  }\n}\n\nexport function peekUniversalTransient<T>(key: UniversalTransientKey): T | null {\n  const globalKey: `(transient) ${UniversalTransientKey}` = `(transient) ${key}`;\n  return (UniversalCache[globalKey] as T) ?? null;\n}\n\nexport function setUniversalTransient<T>(key: UniversalTransientKey, value: T): T {\n  const globalKey: `(transient) ${UniversalTransientKey}` = `(transient) ${key}`;\n  return (UniversalCache[globalKey] = value);\n}\n"],"names":["GlobalRef","globalThis","UniversalCache","__warpDrive_universalCache","name","__version","version","GlobalSink","macroCondition","getGlobalConfig","WarpDrive","env","DEBUG","Error","ModuleScopedCaches","__warpDrive_ModuleScopedCaches","TESTING","console","warn","__warpDrive_hasOtherCopy","getOrSetGlobal","key","value","existing","undefined","peekTransient","globalKey","setTransient","getOrSetUniversal","peekUniversalTransient","setUniversalTransient"],"mappings":";;;;;AAAA;AACA;;AAwGA,MAAMA,SAAS,GAAGC,UASjB,CAAA;AACD,MAAMC,cAAc,GAAIF,SAAS,CAACG,0BAA0B,GAC1DH,SAAS,CAACG,0BAA0B,IAAK,EAAqC,CAAA;;AAEhF;AACA;AACAH,SAAS,CAACI,IAAI,CAAC,GAAGJ,SAAS,CAACI,IAAI,CAAC,IAAI;AAAEC,EAAAA,SAAS,EAAEC,OAAAA;AAAQ,CAAC,CAAA;AAC3D,MAAMC,UAAU,GAAGP,SAAS,CAACI,IAAI,CAAC,CAAA;AAElC,IAAAI,cAAA,CAAAC,eAAA,EAAA,CAAAC,SAAA,CAAAC,GAAA,CAAAC,KAAA,CAAW,EAAA;AACT,EAAA,IAAIL,UAAU,CAACF,SAAS,KAAKC,OAAO,EAAE;AACpC,IAAA,MAAM,IAAIO,KAAK,CAAC,4EAA4E,CAAC,CAAA;AAC/F,GAAA;AACF,CAAA;AAEA,MAAMC,kBAAkB,GAAGP,UAAU,CAACQ,8BAA8B,IAAK,EAAyB,CAAA;AAClG,IAAAP,cAAA,CAAAC,eAAA,EAAA,CAAAC,SAAA,CAAAC,GAAA,CAAAK,OAAA,CAAa,EAAA;AACX,EAAA,IAAI,CAACT,UAAU,CAACQ,8BAA8B,EAAE;IAC9CR,UAAU,CAACQ,8BAA8B,GAAGD,kBAAkB,CAAA;AAChE,GAAC,MAAM;AACL;IACAG,OAAO,CAACC,IAAI,CAAC,CAAA;AACjB;AACA;AACA,gEAAA,CAAiE,CAAC,CAAA;AAChE,GAAA;AACF,CAAC,MAAM;EACL,IAAIX,UAAU,CAACY,wBAAwB,EAAE;AACvC,IAAA,MAAM,IAAIN,KAAK,CAAC,0EAA0E,CAAC,CAAA;AAC7F,GAAA;EACAN,UAAU,CAACY,wBAAwB,GAAG,IAAI,CAAA;AAC5C,CAAA;AAKO,SAASC,cAAcA,CAAyBC,GAAM,EAAEC,KAAQ,EAAwB;EAC7F,IAAAd,cAAA,CAAAC,eAAA,EAAA,CAAAC,SAAA,CAAAC,GAAA,CAAAK,OAAA,CAAa,EAAA;AACX,IAAA,MAAMO,QAAQ,GAAGT,kBAAkB,CAACO,GAAG,CAAC,CAAA;IACxC,IAAIE,QAAQ,KAAKC,SAAS,EAAE;AAC1B,MAAA,OAAQV,kBAAkB,CAACO,GAAG,CAAC,GAAGC,KAAK,CAAA;AACzC,KAAC,MAAM;AACL,MAAA,OAAOC,QAAQ,CAAA;AACjB,KAAA;AACF,GAAC,MAAM;AACL,IAAA,OAAOD,KAAK,CAAA;AACd,GAAA;AACF,CAAA;AAEO,SAASG,aAAaA,CAAIJ,GAAiB,EAAY;AAC5D,EAAA,MAAMK,SAAwC,GAAG,CAAeL,YAAAA,EAAAA,GAAG,CAAE,CAAA,CAAA;AACrE,EAAA,OAAQP,kBAAkB,CAACY,SAAS,CAAC,IAAU,IAAI,CAAA;AACrD,CAAA;AAEO,SAASC,YAAYA,CAAIN,GAAiB,EAAEC,KAAQ,EAAK;AAC9D,EAAA,MAAMI,SAAwC,GAAG,CAAeL,YAAAA,EAAAA,GAAG,CAAE,CAAA,CAAA;AACrE,EAAA,OAAQP,kBAAkB,CAACY,SAAS,CAAC,GAAGJ,KAAK,CAAA;AAC/C,CAAA;AAEO,SAASM,iBAAiBA,CAA4BP,GAAM,EAAEC,KAAQ,EAAwB;EACnG,IAAAd,cAAA,CAAAC,eAAA,EAAA,CAAAC,SAAA,CAAAC,GAAA,CAAAK,OAAA,CAAa,EAAA;AACX,IAAA,MAAMO,QAAQ,GAAGrB,cAAc,CAACmB,GAAG,CAAC,CAAA;IACpC,IAAIE,QAAQ,KAAKC,SAAS,EAAE;AAC1B,MAAA,OAAQtB,cAAc,CAACmB,GAAG,CAAC,GAAGC,KAAK,CAAA;AACrC,KAAC,MAAM;AACL,MAAA,OAAOC,QAAQ,CAAA;AACjB,KAAA;AACF,GAAC,MAAM;AACL,IAAA,OAAOD,KAAK,CAAA;AACd,GAAA;AACF,CAAA;AAEO,SAASO,sBAAsBA,CAAIR,GAA0B,EAAY;AAC9E,EAAA,MAAMK,SAAiD,GAAG,CAAeL,YAAAA,EAAAA,GAAG,CAAE,CAAA,CAAA;AAC9E,EAAA,OAAQnB,cAAc,CAACwB,SAAS,CAAC,IAAU,IAAI,CAAA;AACjD,CAAA;AAEO,SAASI,qBAAqBA,CAAIT,GAA0B,EAAEC,KAAQ,EAAK;AAChF,EAAA,MAAMI,SAAiD,GAAG,CAAeL,YAAAA,EAAAA,GAAG,CAAE,CAAA,CAAA;AAC9E,EAAA,OAAQnB,cAAc,CAACwB,SAAS,CAAC,GAAGJ,KAAK,CAAA;AAC3C;;;;"}