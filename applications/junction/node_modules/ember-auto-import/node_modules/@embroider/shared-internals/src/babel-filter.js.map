{"version":3,"file":"babel-filter.js","sourceRoot":"","sources":["babel-filter.ts"],"names":[],"mappings":";;;;;AAGA,8BAsBC;AAzBD,oEAA2C;AAC3C,oDAA4B;AAE5B,SAAwB,WAAW,CAAC,SAAsD,EAAE,OAAe;IACzG,OAAO,SAAS,mBAAmB,CAAC,QAAgB;QAClD,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE,CAAC;YAC9B,mCAAmC;YACnC,OAAO,KAAK,CAAC;QACf,CAAC;QAED,IAAI,KAAK,GAAG,uBAAY,CAAC,MAAM,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;QAC5E,IAAI,KAAK,EAAE,CAAC;YACV,KAAK,IAAI,EAAE,OAAO,EAAE,GAAG,EAAE,WAAW,EAAE,IAAI,SAAS,EAAE,CAAC;gBACpD,IAAI,KAAK,CAAC,IAAI,KAAK,GAAG,IAAI,CAAC,WAAW,IAAI,IAAI,IAAI,gBAAM,CAAC,SAAS,CAAC,KAAK,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC,EAAE,CAAC;oBAChG,IAAI,KAAK,CAAC,cAAc,EAAE,EAAE,CAAC;wBAC3B,MAAM,IAAI,KAAK,CACb,oHAAoH,CACrH,CAAC;oBACJ,CAAC;oBACD,OAAO,KAAK,CAAC;gBACf,CAAC;YACH,CAAC;QACH,CAAC;QACD,OAAO,IAAI,CAAC;IACd,CAAC,CAAC;AACJ,CAAC;AAED,SAAS,cAAc,CAAC,QAAgB;IACtC,8EAA8E;IAC9E,8EAA8E;IAC9E,2EAA2E;IAC3E,wDAAwD;IACxD,OAAO,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AACtC,CAAC","sourcesContent":["import PackageCache from './package-cache';\nimport semver from 'semver';\n\nexport default function babelFilter(skipBabel: { package: string; semverRange?: string }[], appRoot: string) {\n  return function shouldTranspileFile(filename: string) {\n    if (!babelCanHandle(filename)) {\n      // quick exit for non JS extensions\n      return false;\n    }\n\n    let owner = PackageCache.shared('embroider', appRoot).ownerOfFile(filename);\n    if (owner) {\n      for (let { package: pkg, semverRange } of skipBabel) {\n        if (owner.name === pkg && (semverRange == null || semver.satisfies(owner.version, semverRange))) {\n          if (owner.isEmberPackage()) {\n            throw new Error(\n              `You can't use skipBabel to disable transpilation of Ember addons, it only works for non-Ember third-party packages`\n            );\n          }\n          return false;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction babelCanHandle(filename: string) {\n  // we can handle .mjs, .js and .ts files with babel. If typescript is enabled,\n  // .ts files become resolvable and stage3 will be asking us if they should get\n  // transpiled and the answer is yes. If typescript is not enbled, they will\n  // not be resolvable, so stage3 won't ask us about them.\n  return /\\.m?[jt]s$/i.test(filename);\n}\n"]}