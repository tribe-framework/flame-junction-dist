{"version":3,"file":"working-dir.js","sourceRoot":"","sources":["working-dir.ts"],"names":[],"mappings":";;AAOA,8DA0BC;AAjCD,+BAA+B;AAC/B,2BAAgC;AAChC,uCAAwC;AAExC,MAAM,KAAK,GAAG,IAAI,GAAG,EAAE,CAAC;AAExB,sEAAsE;AACtE,SAAgB,yBAAyB,CAAC,OAAe;;IACvD,IAAI,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE,CAAC;QACvB,OAAO,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;IAC5B,CAAC;IACD,IAAI,OAAO,CAAC,GAAG,CAAC,2BAA2B,EAAE,CAAC;QAC5C,IAAI,IAAI,GAAG,IAAA,cAAO,EAAC,OAAO,EAAE,OAAO,CAAC,GAAG,CAAC,2BAA2B,CAAC,CAAC;QACrE,OAAO,IAAI,CAAC;IACd,CAAC;SAAM,IAAI,IAAA,eAAU,EAAC,IAAA,cAAO,EAAC,OAAO,EAAE,cAAc,CAAC,CAAC,EAAE,CAAC;QACxD,kBAAkB;QAClB,IAAI,IAAI,GAAG,IAAA,cAAO,EAAC,OAAO,EAAE,cAAc,EAAE,YAAY,CAAC,CAAC;QAC1D,KAAK,CAAC,GAAG,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;QACzB,OAAO,IAAI,CAAC;IACd,CAAC;SAAM,CAAC;QACN,oEAAoE;QACpE,sEAAsE;QACtE,WAAW;QACX,IAAI,IAAA,eAAU,EAAC,IAAA,cAAO,EAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,cAAc,CAAC,CAAC,EAAE,CAAC;YAC7D,IAAI,GAAG,GAAG,IAAA,uBAAY,EAAC,IAAA,cAAO,EAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,cAAc,CAAC,CAAC,CAAC;YACrE,IAAI,MAAA,GAAG,CAAC,QAAQ,0CAAE,QAAQ,CAAC,aAAa,CAAC,EAAE,CAAC;gBAC1C,IAAI,IAAI,GAAG,IAAA,cAAO,EAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,cAAc,EAAE,YAAY,CAAC,CAAC;gBACtE,KAAK,CAAC,GAAG,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;gBACzB,OAAO,IAAI,CAAC;YACd,CAAC;QACH,CAAC;QACD,MAAM,IAAI,KAAK,CAAC,sBAAsB,CAAC,CAAC;IAC1C,CAAC;AACH,CAAC","sourcesContent":["import { resolve } from 'path';\nimport { existsSync } from 'fs';\nimport { readJSONSync } from 'fs-extra';\n\nconst cache = new Map();\n\n// Most of this only exists because of classic dummy apps being weird.\nexport function locateEmbroiderWorkingDir(appRoot: string): string {\n  if (cache.has(appRoot)) {\n    return cache.get(appRoot);\n  }\n  if (process.env.EMBROIDER_WORKING_DIRECTORY) {\n    let path = resolve(appRoot, process.env.EMBROIDER_WORKING_DIRECTORY);\n    return path;\n  } else if (existsSync(resolve(appRoot, 'package.json'))) {\n    // the normal case\n    let path = resolve(appRoot, 'node_modules', '.embroider');\n    cache.set(appRoot, path);\n    return path;\n  } else {\n    // probably in a dummy app (sigh), but let's do a little checking to\n    // distinguish that case from someone pointing embroider at a nonsense\n    // location\n    if (existsSync(resolve(appRoot, '..', '..', 'package.json'))) {\n      let pkg = readJSONSync(resolve(appRoot, '..', '..', 'package.json'));\n      if (pkg.keywords?.includes('ember-addon')) {\n        let path = resolve(appRoot, '..', '..', 'node_modules', '.embroider');\n        cache.set(appRoot, path);\n        return path;\n      }\n    }\n    throw new Error('unable to locate app');\n  }\n}\n"]}